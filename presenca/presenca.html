<!DOCTYPE html>
<html lang="pt-BR">
<head>
    <meta charset="UTF-8">
    <title>Lista de Presença</title>

    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
</head>
<body>

<div class="container mt-4">
    <h2>Lista de Presença</h2>

    <button class="btn btn-primary" data-bs-toggle="modal" data-bs-target="#modalDatas">
        Selecionar Datas
    </button>

    <div id="areaLista" class="mt-4"></div>
</div>

<!-- MODAL -->
<div class="modal fade" id="modalDatas">
    <div class="modal-dialog">
        <div class="modal-content">

            <div class="modal-header">
                <h5>Selecionar Período</h5>
                <button class="btn-close" data-bs-dismiss="modal"></button>
            </div>

            <div class="modal-body">
                <label>Data inicial</label>
                <input type="date" id="dataInicio" class="form-control mb-3">

                <label>Data final</label>
                <input type="date" id="dataFim" class="form-control">
            </div>

            <div class="modal-footer">
                <button class="btn btn-success" onclick="gerarLista()">Gerar</button>
            </div>

        </div>
    </div>
</div>

<script>
    const API = "http://localhost:3000";

    async function gerarLista() {
        const inicio = dataInicio.value;
        const fim = dataFim.value;
        const area = document.getElementById("areaLista");

        area.innerHTML = "";

        const datas = gerarIntervaloDatas(inicio, fim);

        for (const data of datas) {

            const resp = await fetch(`${API}/colaboradores/por-data?data=${data}`);
            const lista = await resp.json();

            if (!lista.length) continue;

            area.innerHTML += `
            <h4 class="mt-4">${formatarData(data)}</h4>
            <table class="table table-bordered">
                <thead class="table-dark">
                    <tr>
                        <th>Nome</th>
                        <th>Tipo</th>
                        <th>Presente</th>
                        <th>Comentário</th>
                    </tr>
                </thead>
                <tbody>
                    ${lista.map(c => `
                        <tr>
                            <td>${c.nome}</td>
                            <td>${c.contratacao}</td>
                            <td><input type="checkbox"></td>
                            <td><input class="form-control"></td>
                        </tr>
                    `).join("")}
                </tbody>
            </table>
        `;
        }

        bootstrap.Modal.getInstance(modalDatas).hide();
    }

    function gerarIntervaloDatas(inicio, fim) {
        const d1 = new Date(inicio);
        const d2 = new Date(fim);
        const lista = [];

        while (d1 <= d2) {
            lista.push(d1.toISOString().split("T")[0]);
            d1.setDate(d1.getDate() + 1);
        }
        return lista;
    }

    function formatarData(data) {
        const [y, m, d] = data.split("-");
        return `${d}/${m}/${y}`;
    }
</script>

<script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"></script>

</body>
</html>
