<!DOCTYPE html>
<html lang="pt-BR">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>Lista de Colaboradores</title>
  <link rel="stylesheet" href="lista.css">
  
  <!-- BOOTSTRAP CSS -->
  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
</head>
<body>

  <div class="container container-box mt-4">
    <div class="d-flex justify-content-between align-items-center mb-3">
      <h2>Lista de Colaboradores</h2>
      <div class="d-flex gap-2">
        <a href="../pagina-registro/cadastro.html" class="btn btn-primary"> Novo Colaborador</a>
        <a href="../dashboard/dashboard.html" class="btn btn-success">üìä Dashboard</a>
        <a href="../presenca/presenca.html" class="btn btn-success">Lista de Presen√ßa</a>

        <button class="btn btn-outline-danger" id="btnLogout">Sair</button>
      </div>
    </div>

    <!-- Busca -->
    <input type="text" id="busca" class="form-control mb-3" placeholder="Buscar por nome, CPF, cidade, setor...">

    <!-- Tabela -->
    <div class="table-responsive">
      <table class="table table-striped table-hover">
        <thead class="table-primary">
          <tr>
            <th onclick="ordenar('nome')">Nome</th>
            <th onclick="ordenar('cpf')">CPF</th>
            <th onclick="ordenar('email')">E-mail</th>
            <th onclick="ordenar('telefone')">Telefone</th>
            <th onclick="ordenar('cidade')">Cidade</th>
            <th onclick="ordenar('contratacao')">Contrata√ß√£o</th>
            <th onclick="ordenar('setor')">Setor</th>
            <th onclick="ordenar('carga')">Carga Hor√°ria</th>
            <th onclick="ordenar('status')">Ativo</th>
            <th>A√ß√µes</th>
          </tr>
        </thead>
        <tbody id="tabelaColaboradores"></tbody>
      </table>
    </div>
  </div>

  <!-- Modal Status -->
  <div class="modal fade" id="modalStatus" tabindex="-1" aria-hidden="true">
    <div class="modal-dialog modal-dialog-centered">
      <div class="modal-content">
        <div class="modal-header bg-info text-white">
          <h5 class="modal-title">Status do Colaborador</h5>
          <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Fechar"></button>
        </div>
        <div class="modal-body">
          <p><strong>Nome:</strong> <span id="statusNome"></span></p>
          <p><strong>CPF:</strong> <span id="statusCPF"></span></p>
          <p><strong>E-mail:</strong> <span id="statusEmail"></span></p>
          <p><strong>Telefone:</strong> <span id="statusTelefone"></span></p>
          <p><strong>Cidade:</strong> <span id="statusCidade"></span></p>
          <hr>
          <p><strong>Contrata√ß√£o:</strong> <span id="statusContratacao"></span></p>
          <p><strong>Setor:</strong> <span id="statusSetor"></span></p>
          <p><strong>Carga Hor√°ria:</strong> <span id="statusCarga"></span></p>
          <p><strong>Status:</strong> <span id="statusSituacao"></span></p>
        </div>
        <div class="modal-footer">
          <button class="btn btn-secondary" data-bs-dismiss="modal">Fechar</button>
        </div>
      </div>
    </div>
  </div>

<script>
    const API_URL = "http://localhost:3000";
    const token = localStorage.getItem("token");

    // ‚ö†Ô∏è Desative enquanto ainda est√° testando sem login
    // if(!token){
    //     window.location.href = "../login/login.html";
    // }

    const lista = document.getElementById("tabelaColaboradores");
    const busca = document.getElementById("busca");

    // ============================
    //   CARREGAR LISTA
    // ============================
    async function carregar(){
        try {
            const resp = await fetch(`${API_URL}/colaboradores`);
            const dados = await resp.json();
            montar(dados);
        } catch (e) {
            console.log("Erro ao carregar colaboradores:", e);
        }
    }

    // ============================
    //   MONTAR TABELA
    // ============================
    function montar(dados){
        lista.innerHTML = "";

        dados.forEach(c => {
            const tr = document.createElement("tr");

           tr.innerHTML = `
                <td>${c.nome}</td>
                <td>${c.cpf}</td>
                <td>${c.email}</td>
                <td>${c.telefone}</td>
                <td>${c.cidade}</td>
                <td>${c.contratacao}</td>
                <td>${c.setor}</td>
                <td>${c.carga}</td>
                <td>${c.ativo}</td>
                <td>
                    <button class="btn yellow" onclick="editar(${c.id})">Editar</button>
                    <button class="btn red" onclick="excluir(${c.id})">Excluir</button>
                    <button class="btn cyan">Status</button>
                </td>
            `;


            lista.appendChild(tr);
        });
    }

    // ============================
    //   EDITAR
    // ============================
    function editar(id){
        window.location.href = `../pagina-registro/cadastro.html?id=${id}`;
    }

    // ============================
    //   EXCLUIR
    // ============================
    async function excluir(id){
        if(!confirm("Tem certeza que deseja excluir?")) return;

        await fetch(`${API_URL}/colaboradores/${id}`, {
            method: "DELETE"
        });

        carregar();
    }

    // ============================
    //   BUSCA
    // ============================
    busca.addEventListener("input", async () => {
        const termo = busca.value.toLowerCase();

        const resp = await fetch(`${API_URL}/colaboradores`);
        const dados = await resp.json();

        const filtrados = dados.filter(c =>
            c.nome.toLowerCase().includes(termo) ||
            c.cpf.toLowerCase().includes(termo) ||
            c.cidade.toLowerCase().includes(termo) ||
            c.setor.toLowerCase().includes(termo)
        );

        montar(filtrados);
    });

    carregar();
</script>

</body>
</html>
