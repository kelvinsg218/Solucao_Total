<!DOCTYPE html>
<html lang="pt-BR">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Sistema de Cadastro - Logística</title>
    <link rel="stylesheet" href="cadastro.css">
</head>

<body>
    <div class="container">
        <div class="header">
            <h1>Cadastro de Colaborador</h1>
            <p>Sistema interno • Logística</p>
        </div>

        <form class="form">
            <h2>Dados Pessoais</h2>
            <div class="grid">
                <div class="input-group">
                    <label>Nome Completo</label>
                    <input id="nome" type="text" placeholder="Ex: João da Silva" required>
                </div>

                <div class="input-group">
                    <label>Email</label>
                    <input id="email" type="email" placeholder="Ex: joao.silva@empresa.com" required>
                </div>

                <div class="input-group">
                    <label>CPF</label>
                    <input id="cpf" type="text" maxlength="14" placeholder="Ex: 123.456.789-00"
                        oninput="mascaraCPF(this)" required>
                </div>

                <div class="input-group">
                    <label>Telefone</label>
                    <input id="telefone" type="text" maxlength="15" placeholder="Ex: (11) 91234-5678"
                        oninput="mascaraTelefone(this)" required>
                </div>
            </div>

            <h2>Endereço</h2>
            <div class="grid">
                <div class="input-group">
                    <label>CEP</label>
                    <input id="cep" type="text" maxlength="9" placeholder="Ex: 29100-000"
                        oninput="mascaraCEP(this); buscarCEP(this.value)" required>
                </div>

                <div class="input-group">
                    <label>Endereço</label>
                    <input id="endereco" type="text" placeholder="Ex: Rua das Flores" required>
                </div>

                <div class="input-group">
                    <label>Número</label>
                    <input id="numero" type="text" placeholder="Ex: 120">
                </div>

                <div class="input-group">
                    <label>Cidade</label>
                    <input id="cidade" type="text" placeholder="Ex: Serra" required>
                </div>

                <div class="input-group">
                    <label>Estado</label>
                    <input id="estado" type="text" maxlength="2" placeholder="Ex: ES" required>
                </div>
            </div>

            <h2>Dados da Empresa</h2>
            <div class="grid">
                <div class="input-group">
                    <label>Armazém</label>
                    <select id="armazem" required>
                        <option value="">Selecione...</option>
                        <option value="Taquara">Taquara</option>
                        <option value="Porto Canoa">Porto Canoa</option>
                        <option value="Civit II">Civit II</option>
                        <option value="Log 101">Log 101</option>
                    </select>
                </div>

                <div class="input-group">
                    <label>Contratação</label>
                    <select id="contratacao" required>
                        <option value="">Selecione...</option>
                        <option value="Diarista">Diarista</option>
                        <option value="Funcionário">Funcionário</option>
                    </select>
                </div>

                <div class="input-group">
                    <label>Setor</label>
                    <input id="setor" type="text" placeholder="Ex: Separação" required>
                </div>

                <div class="input-group">
                    <label>Carga Horária</label>
                    <select id="carga" required>
                        <option value="">Selecione...</option>
                        <option value="07:00 às 17:00">07:00 às 17:00</option>
                        <option value="08:00 às 18:00">08:00 às 18:00</option>
                        <option value="09:00 às 19:00">09:00 às 19:00</option>
                        <option value="10:00 às 20:00">10:00 às 20:00</option>
                    </select>
                </div>

                <div class="input-group">
                    <label>Ativo</label>
                    <select id="ativo" required>
                        <option value="">Selecione...</option>
                        <option value="Sim">Sim</option>
                        <option value="Não">Não</option>
                    </select>
                </div>
            </div>

            <button type="submit" class="btn">Salvar Cadastro</button>
        </form>
    </div>

    <script>
        // ====== PEGAR PARÂMETRO DE EDIÇÃO ======
        const urlParams = new URLSearchParams(window.location.search);
        const idEdicao = urlParams.get("id"); // null se não tiver parâmetro

        // ====== CARREGAR DADOS PARA EDIÇÃO ======
        if (idEdicao !== null) {
            const lista = JSON.parse(localStorage.getItem("colaboradores")) || [];
            const colab = lista[idEdicao];
            if (colab) {
                document.getElementById("nome").value = colab.nome || "";
                document.getElementById("email").value = colab.email || "";
                document.getElementById("cpf").value = colab.cpf || "";
                document.getElementById("telefone").value = colab.telefone || "";
                document.getElementById("cep").value = colab.cep || "";
                document.getElementById("endereco").value = colab.endereco || "";
                document.getElementById("numero").value = colab.numero || "";
                document.getElementById("cidade").value = colab.cidade || "";
                document.getElementById("estado").value = colab.estado || "";
                document.getElementById("armazem").value = colab.armazem || "";
                document.getElementById("contratacao").value = colab.contratacao || "";
                document.getElementById("setor").value = colab.setor || "";
                document.getElementById("carga").value = colab.carga || "";
                document.getElementById("ativo").value = colab.status || colab.ativo || "";
            }
        }

        // ====== SALVAR CADASTRO ======
        document.querySelector(".form").addEventListener("submit", function (e) {
            e.preventDefault();

            const statusVal = document.getElementById("ativo").value;

            const colaborador = {
                nome: nome.value,
                email: email.value,
                cpf: cpf.value,
                telefone: telefone.value,
                cep: cep.value,
                endereco: endereco.value,
                numero: numero.value,
                cidade: cidade.value,
                estado: estado.value,
                armazem: armazem.value,
                contratacao: contratacao.value,
                setor: setor.value,
                carga: carga.value,
                status: statusVal
            };

            let lista = JSON.parse(localStorage.getItem("colaboradores")) || [];

            if (idEdicao !== null) {
                lista[idEdicao] = colaborador; // atualiza
            } else {
                lista.push(colaborador); // adiciona novo
            }

            localStorage.setItem("colaboradores", JSON.stringify(lista));

            window.location.href = "../lista/lista.html"; // redireciona
        });
    </script>
</body>
</html>
